{% extends 'admin/base.html.twig' %}

{% block title %}Réservations - Jardins Harmonie{% endblock %}

{% block main %}
    <style>

        /* Settings Button (Header) */
        .settings-btn {
            width: 48px;
            height: 48px;
            background-color: var(--bs-primary, #0d6efd);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .settings-btn:hover {
            transform: rotate(90deg);
            background-color: #0b5ed7;
        }
        .settings-btn i {
            font-size: 1.5rem;
        }
    </style>
    <div class="dashboard-container">

        <main class="dashboard-main reservation-page">
            <header class="dashboard-header d-flex justify-content-between align-items-center bg-white border-bottom p-4">
                <h2>Interventions</h2>
                <a href="{{ path('admin_parametres') }}" class="text-decoration-none">
                    <div class="settings-btn">
                        <i class="bi bi-gear-fill"></i>
                    </div>
                </a>
            </header>

            <div class="dashboard-content p-0 h-100">

                <!-- Filters en ligne -->
                <h5 class="fw-bold mb-4">Filtres</h5>
                <div class="reservation-filters p-3 bg-white d-flex flex-row flex-wrap gap-3 align-items-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="filterAll" checked>
                        <label class="form-check-label" for="filterAll">Tout voir</label>
                    </div>
                    {% for service in services %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{ service }}" id="filter{{ service }}">
                            <label class="form-check-label" for="filter{{ service }}">{{ service }}</label>
                        </div>
                    {% endfor %}
                </div>

                <!-- Liste des réservations -->
                <section class="reservation-list p-4 bg-light">
                    <div id="reservation-container">
                        {% for res in reservations %}
                            <div class="reservation-card bg-white p-3 rounded-3 shadow-sm mb-3" data-category="{{ res.service|lower }}">
                                <div class="d-flex justify-content-start align-items-center gap-5 mb-2">
                                    <div class="d-flex align-items-center gap-3 text-muted small">
                                        <span>{{ res.heure_debut }} - {{ res.heure_fin }}</span>
                                        <span>{{ res.date|date('d M Y') }}</span>
                                    </div>
                                    <div class="fw-bold text-dark">{{ res.service }}</div>
                                    <div class="text-muted small">{{ res.nom }}</div>
                                </div>
{#                                <p class="text-muted small mb-3">{{ res.description ?? '—' }}</p>#}
                                <a href="{{ path('admin_reservation_details', {'id': res.id}) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                    Consulter
                                </a>
                            </div>
                        {% else %}
                            <p class="text-muted small">Aucune réservation disponible.</p>
                        {% endfor %}
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterAll = document.getElementById('filterAll');
            const serviceFilters = document.querySelectorAll('input[type="checkbox"][id^="filter"]:not(#filterAll)');
            const cards = document.querySelectorAll('.reservation-card');

            function filterReservations() {
                const checkedFilters = Array.from(serviceFilters)
                    .filter(input => input.checked)
                    .map(input => input.value.toLowerCase());

                const isAll = filterAll.checked;

                cards.forEach(card => {
                    if (isAll && checkedFilters.length === 0) {
                        card.style.display = '';
                        return;
                    }

                    const category = card.getAttribute('data-category').toLowerCase();
                    // Check if category ("tonte, taille") includes any of the checked filters ("tonte")
                    const matches = checkedFilters.some(filter => category.includes(filter));

                    if (checkedFilters.length > 0) {
                        if (matches) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    } else if (isAll) {
                        card.style.display = '';
                    } else {
                        // Nothing checked? Show all or none? Usually show all if "All" is implicitly default,
                        // but here "Tout voir" is a checkbox.
                        // Logic: If Tout voir is unchecked and no services checked -> Show nothing? Or All?
                        // Let's assume Show Nothing if nothing checked to be strict, or re-check "All".
                        card.style.display = 'none';
                    }
                });
            }

            filterAll.addEventListener('change', function() {
                if (this.checked) {
                    serviceFilters.forEach(f => f.checked = false);
                }
                filterReservations();
            });

            serviceFilters.forEach(filter => {
                filter.addEventListener('change', function() {
                    if (this.checked) {
                        filterAll.checked = false;
                    }
                    // If all uncheck, maybe recheck All?
                    const anyChecked = Array.from(serviceFilters).some(f => f.checked);
                    if (!anyChecked) {
                        filterAll.checked = true;
                    }
                    filterReservations();
                });
            });
        });
    </script>
{% endblock %}



